# arc_redirect v1.1
# Love redirects, hate 404s
# Andy Carter
# http://andy-carter.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhcmNfcmVkaXJlY3QiO3M6NzoidmVyc2lvbiI7czoz
OiIxLjEiO3M6NjoiYXV0aG9yIjtzOjExOiJBbmR5IENhcnRlciI7czoxMDoiYXV0aG9yX3Vy
aSI7czoyMzoiaHR0cDovL2FuZHktY2FydGVyLmNvbS8iO3M6MTE6ImRlc2NyaXB0aW9uIjtz
OjI1OiJMb3ZlIHJlZGlyZWN0cywgaGF0ZSA0MDRzIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIxIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6NDoiaGVscCI7czoyMTQ3
OiIJPGgxIGNsYXNzPSJ0aXRsZSI+YXJjX3JlZGlyZWN0IChsb3ZlIHJlZGlyZWN0cywgaGF0
ZSA0MDRzKTwvaDE+CgoJPHA+SWYgeW91JiM4MjE3O3JlIGluIHRoZSBwcm9jZXNzIG9mIHJl
c3RydWN0dXJpbmcgYSBUZXh0cGF0dGVybiBzaXRlLCB0aGVuIHRoaXMgaXMgdGhlIHBsdWdp
biBmb3IgeW91ITwvcD4KCgk8cD5SZXF1aXJlbWVudHM6LTwvcD4KCgk8dWw+CgkJPGxpPlRl
eHRwYXR0ZXJuIDQuNSs8L2xpPgoJPC91bD4KCgk8aDIgY2xhc3M9InNlY3Rpb24iPkF1dGhv
cjwvaDI+CgoJPHA+PGEgaHJlZj0iaHR0cDovL2FuZHktY2FydGVyLmNvbSI+QW5keSBDYXJ0
ZXI8L2E+LiBGb3Igb3RoZXIgVGV4dHBhdHRlcm4gcGx1Z2lucyBieSBtZSB2aXNpdCBteSA8
YSBocmVmPSJodHRwOi8vYW5keS1jYXJ0ZXIuY29tL3R4cCI+UGx1Z2lucyBwYWdlPC9hPi48
L3A+CgoJPHA+VGhhbmtzIHRvIDxhIGhyZWY9Imh0dHA6Ly9vbGl2ZXJrZXIuY28udWsvIj5P
bGl2ZXIgS2VyPC9hPiBmb3IgZ2l2aW5nIG1lIHRoZSBpZGVhIGZvciB0aGlzIHBsdWdpbi48
L3A+CgoJPGgyIGNsYXNzPSJzZWN0aW9uIj5JbnN0YWxsYXRpb24gLyBVbmluc3RhbGxhdGlv
bjwvaDI+CgoJPHA+VG8gaW5zdGFsbCBnbyB0byB0aGUgJiM4MjE2O3BsdWdpbnMmIzgyMTc7
IHRhYiB1bmRlciAmIzgyMTY7YWRtaW4mIzgyMTc7IGFuZCBwYXN0ZSB0aGUgcGx1Z2luIGNv
ZGUgaW50byB0aGUgJiM4MjE2O0luc3RhbGwgcGx1Z2luJiM4MjE3OyBib3gsICYjODIxNjt1
cGxvYWQmIzgyMTc7IGFuZCB0aGVuICYjODIxNjtpbnN0YWxsJiM4MjE3Oy4gRmluYWxseSBh
Y3RpdmF0ZSB0aGUgcGx1Z2luLjwvcD4KCgk8cD5UbyB1bmluc3RhbGwgPHNwYW4gY2xhc3M9
InRhZyI+YXJjX3JlZGlyZWN0PC9zcGFuPiBzaW1wbHkgZGVsZXRlIHRoZSBwbHVnaW4gZnJv
bSB0aGUgJiM4MjE2O1BsdWdpbnMmIzgyMTc7IHRhYi4gIFRoaXMgd2lsbCByZW1vdmUgdGhl
IHBsdWdpbiBjb2RlIGFuZCBkcm9wIHRoZSA8c3BhbiBjbGFzcz0idGFnIj5hcmNfcmVkaXJl
Y3Q8L3NwYW4+IHRhYmxlIGZyb20geW91ciBUZXh0cGF0dGVybiBkYXRhYmFzZS48L3A+CgoJ
PGgyIGNsYXNzPSJzZWN0aW9uIj5Vc2FnZTwvaDI+CgoJPHA+PHNwYW4gY2xhc3M9InRhZyI+
YXJjX3JlZGlyZWN0PC9zcGFuPiBhZGRzIGEgbmV3IHRhYiB1bmRlciAmIzgyMTY7RXh0ZW5z
aW9ucyYjODIxNzsgZnJvbSB3aGVyZSB5b3UgY2FuIGRlZmluZSBwYWlycyBvZiA8c3BhbiBj
bGFzcz0iY2FwcyI+VVJMPC9zcGFuPnMgZm9yIGhhbmRsaW5nIHJlZGlyZWN0cy4gQmFzaWNh
bGx5IHByb3ZpZGUgYW4gb3JpZ2luYWwgPHNwYW4gY2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj4g
b24geW91ciBUZXh0cGF0dGVybiBzaXRlIHRoYXQgaXMgZ2VuZXJhdGluZyBhIDQwNCwgJiM4
MjIwO3BhZ2Ugbm90IGZvdW5kJiM4MjIxOywgZXJyb3IgYW5kIGEgcmVkaXJlY3QgPHNwYW4g
Y2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj4uIFRoZW4gd2hlbmV2ZXIgc29tZW9uZSBnb2VzIHRv
IHRoZSBvcmlnaW5hbCA8c3BhbiBjbGFzcz0iY2FwcyI+VVJMPC9zcGFuPiByYXRoZXIgdGhh
biBnZXQgdGhlIHN0YW5kYXJkIDQwNCBlcnJvciBwYWdlIHRoZXkgd2lsbCBiZSByZWRpcmN0
ZWQgdG8gdGhlIG5ldyA8c3BhbiBjbGFzcz0iY2FwcyI+VVJMPC9zcGFuPiAod2l0aCBhIDMw
MSBwZXJtZW5hbnRlbHkgbW92ZWQpLjwvcD4KCgk8cD5UaGUgcmVkaXJlY3QgZnJvbSA8c3Bh
biBjbGFzcz0iY2FwcyI+VVJMPC9zcGFuPiBtdXN0IHByb2R1Y2UgYSA0MDQgcGFnZSBpbiBU
ZXh0cGF0dGVybiBvbiB0aGUgc2l0ZSB0aGlzIHBsdWdpbiBpcyBpbnN0YWxsZWQuPC9wPgoK
CTx1bD4KCQk8bGk+PHNwYW4gY2xhc3M9InRhZyI+YXJjX3JlZGlyZWN0PC9zcGFuPiB0cmVh
dHMgaHR0cDovL3d3dy5leGFtcGxlLmNvbS9taXNzaW5nIHRoZSBzYW1lIGFzIGh0dHA6Ly93
d3cuZXhhbXBsZS5jb20vbWlzc2luZy88L2xpPgoJCTxsaT48c3BhbiBjbGFzcz0idGFnIj5h
cmNfcmVkaXJlY3Q8L3NwYW4+IGRvZXMgbm90IHRyZWF0IGh0dHA6Ly9leGFtcGxlLmNvbS9t
aXNzaW5nIGFuZCBodHRwOi8vd3d3LmV4YW1wbGUuY29tL21pc3NpbmcgYXMgdGhlIHNhbWUg
PHNwYW4gY2xhc3M9ImNhcHMiPlVSTDwvc3Bhbj48L2xpPgoJPC91bD4KCiI7czo0OiJjb2Rl
IjtzOjc3MTI6InJlZ2lzdGVyX2NhbGxiYWNrKCdhcmNfcmVkaXJlY3RfaW5zdGFsbCcsJ3Bs
dWdpbl9saWZlY3ljbGUuYXJjX3JlZGlyZWN0JywgJ2luc3RhbGxlZCcpOwpyZWdpc3Rlcl9j
YWxsYmFjaygnYXJjX3JlZGlyZWN0X3VuaW5zdGFsbCcsJ3BsdWdpbl9saWZlY3ljbGUuYXJj
X3JlZGlyZWN0JywgJ2RlbGV0ZWQnKTsKcmVnaXN0ZXJfY2FsbGJhY2soJ2FyY19yZWRpcmVj
dCcsICd0eHBfZGllJywgNDA0KTsKYWRkX3ByaXZzKCdhcmNfcmVkaXJlY3QnLCAnMSwyLDMs
NCcpOwpyZWdpc3Rlcl90YWIoJ2V4dGVuc2lvbnMnLCAnYXJjX3JlZGlyZWN0JywgJ2FyY19y
ZWRpcmVjdCcpOwpyZWdpc3Rlcl9jYWxsYmFjaygnYXJjX3JlZGlyZWN0X3RhYicsICdhcmNf
cmVkaXJlY3QnKTsKCi8qCiAqIENoZWNrIGZvciByZWRpcmVjdGVkIFVSTHMgYW5kIGZvcndh
cmQgd2l0aCBhIDMwMSB3aGVyZSBuZWNlc3NhcnkuCiAqLwpmdW5jdGlvbiBhcmNfcmVkaXJl
Y3QoJGV2ZW50LCAkc3RlcCkgewogICR1cmwgPSBQUk9UT0NPTC4kX1NFUlZFUlsnU0VSVkVS
X05BTUUnXS4kX1NFUlZFUlsnUkVRVUVTVF9VUkknXTsKCiAgLy8gU3RyaXAgZmluYWwgc2xh
c2ggZnJvbSB1cmwKICAkdXJsID0gcnRyaW0oJHVybCwgJy8nKTsKCiAgJHVybCA9IGRvU2xh
c2goJHVybCk7CgogICRyZWRpcmVjdCA9IHNhZmVfcm93KCdyZWRpcmVjdFVybCcsICdhcmNf
cmVkaXJlY3QnLCAib3JpZ2luYWxVcmwgPSAnJHVybCciKTsKCgkgIGlmIChpc3NldCgkcmVk
aXJlY3RbJ3JlZGlyZWN0VXJsJ10pKSB7CgkJICBvYl9lbmRfY2xlYW4oKTsKCgkJICBoZWFk
ZXIoIlN0YXR1czogMzAxIik7CgkJICBoZWFkZXIoIkhUVFAvMS4wIDMwMSBNb3ZlZCBQZXJt
YW5lbnRseSIpOwoJCSAgaGVhZGVyKCJMb2NhdGlvbjogIi4kcmVkaXJlY3RbJ3JlZGlyZWN0
VXJsJ10sIFRSVUUsIDMwMSk7CgoJCSAgLy8gSW4gY2FzZSB0aGUgaGVhZGVyKCkgbWV0aG9k
IGZhaWxzLCBmYWxsIGJhY2sgb24gYSBjbGFzc2ljIHJlZGlyZWN0CgkJICBlY2hvICc8aHRt
bD48aGVhZD48TUVUQSBIVFRQLUVRVUlWPSJSZWZyZXNoIiBDT05URU5UPSIwO1VSTD0nCgkJ
ICAgIC4gJHJlZGlyZWN0WydyZWRpcmVjdFVybCddIC4gJyI+PC9oZWFkPjxib2R5PjwvYm9k
eT48L2h0bWw+JzsKCQkgIGRpZSgpOwoJICB9Cgp9CgpmdW5jdGlvbiBhcmNfcmVkaXJlY3Rf
dGFiKCRldmVudCwgJHN0ZXApIHsKICBzd2l0Y2ggKCRzdGVwKSB7CiAgICBjYXNlICdhZGQn
OiBhcmNfcmVkaXJlY3RfYWRkKCk7IGJyZWFrOwogICAgY2FzZSAnc2F2ZSc6IGFyY19yZWRp
cmVjdF9zYXZlKCk7IGJyZWFrOwogICAgY2FzZSAnZWRpdCc6IGFyY19yZWRpcmVjdF9lZGl0
KCk7IGJyZWFrOwogICAgY2FzZSAnYXJjX3JlZGlyZWN0X211bHRpZWRpdCc6IGFyY19yZWRp
cmVjdF9tdWx0aWVkaXQoKTsgYnJlYWs7CiAgICBkZWZhdWx0OiBhcmNfcmVkaXJlY3RfbGlz
dCgpOwogIH0KfQoKZnVuY3Rpb24gYXJjX3JlZGlyZWN0X2xpc3QoJG1lc3NhZ2UgPSAnJykg
ewoKICBnbG9iYWwgJGV2ZW50OwoKICBleHRyYWN0KGdwc2EoYXJyYXkoJ3BhZ2UnKSkpOwoK
ICBwYWdldG9wKCdhcmNfcmVkaXJlY3QnLCRtZXNzYWdlKTsKCiAgJGNyaXRlcmlhID0gMTsK
CiAgJHRvdGFsID0gZ2V0Q291bnQoJ2FyY19yZWRpcmVjdCcsICRjcml0ZXJpYSk7CgogICRs
aW1pdCA9IDI1OwogIGxpc3QoJHBhZ2UsICRvZmZzZXQsICRudW1QYWdlcykgPSBwYWdlcigk
dG90YWwsICRsaW1pdCwgJHBhZ2UpOwoKICAkc29ydF9zcWwgPSAnYXJjX3JlZGlyZWN0SUQg
ZGVzYyc7CgogICRycyA9IHNhZmVfcm93c19zdGFydCgnKicsICdhcmNfcmVkaXJlY3QnLCAi
JGNyaXRlcmlhIG9yZGVyIGJ5ICRzb3J0X3NxbCBsaW1pdCAkb2Zmc2V0LCAkbGltaXQiKTsK
CiAgJGh0bWwgPSAiPGgxIGNsYXNzPSd0eHAtaGVhZGluZyc+YXJjX3JlZGlyZWN0PC9oMT4i
OwogIC8vIEluY2x1ZGUgYSBxdWljayBhZGQgZm9ybQogICRmb3JtID0gIjxwPjxzcGFuIGNs
YXNzPSdlZGl0LWxhYmVsJz48bGFiZWwgZm9yPSdvcmlnaW5hbFVybCc+UmVkaXJlY3QgZnJv
bSBVUkwgKHByb2R1Y2VzIDQwNCBwYWdlKTwvbGFiZWw+PC9zcGFuPiI7CiAgJGZvcm0gLj0g
IjxzcGFuIGNsYXNzPSdlZGl0LXZhbHVlJz4iIC4gZklucHV0KCd0ZXh0JywgJ29yaWdpbmFs
VXJsJywgJycsICcnLCAnJywgJycsICcnLCAnJywgJ29yaWdpbmFsVXJsJykgLiAiPC9zcGFu
PjwvcD4iOwogICRmb3JtIC49ICI8cD48c3BhbiBjbGFzcz0nZWRpdC1sYWJlbCc+PGxhYmVs
IGZvcj0ncmVkaXJlY3RVcmwnPlJlZGlyZWN0IHRvIFVSTDwvbGFiZWw+PC9zcGFuPiI7CiAg
JGZvcm0gLj0gIjxzcGFuIGNsYXNzPSdlZGl0LXZhbHVlJz4iIC4gZklucHV0KCd0ZXh0Jywg
J3JlZGlyZWN0VXJsJywgJycsICcnLCAnJywgJycsICcnLCAnJywgJ3JlZGlyZWN0VXJsJykg
LiAnJm5ic3A7JyAuIGZJbnB1dCgnc3VibWl0JywgJ2FkZCcsIGdUeHQoJ0FkZCcpKSAuICI8
L3NwYW4+PC9wPiI7CgogICRmb3JtIC49IGVJbnB1dCgnYXJjX3JlZGlyZWN0Jykuc0lucHV0
KCdhZGQnKTsKICAkaHRtbCAuPSBmb3JtKCI8ZGl2IGNsYXNzPSdwbHVnaW4tY29sdW1uJz4i
IC4gJGZvcm0gLiAiPC9kaXY+IiwgJycsICcnLCAnJywgJ2VkaXQtZm9ybScpOwoKICAvLyBB
ZGQgYSBsaXN0IG9mIGV4aXN0aW5nIHJlZGlyZWN0cwogICRodG1sIC49IG4ubi4nPGZvcm0g
YWN0aW9uPSJpbmRleC5waHAiIGlkPSJhcmNfcmVkaXJlY3RfZm9ybSIgY2xhc3M9Im11bHRp
X2VkaXRfZm9ybSIgbWV0aG9kPSJwb3N0IiBuYW1lPSJsb25nZm9ybSI+JzsKICAkaHRtbCAu
PSBzdGFydFRhYmxlKG51bGwsIG51bGwsICd0eHAtbGlzdCcpOwoKICAkaHRtbCAuPSAnPHRo
ZWFkPicgLiB0cigKICAgIGhDZWxsKGZJbnB1dCgnY2hlY2tib3gnLCAnc2VsZWN0X2FsbCcs
IDAsICcnLCAnJywgJycsICcnLCAnJywgJ3NlbGVjdF9hbGwnKSwgJycsICcgdGl0bGU9IlRv
Z2dsZSBhbGwvbm9uZSBzZWxlY3RlZCIgY2xhc3M9Im11bHRpLWVkaXQiJykKICAgIC5oQ2Vs
bCgnSUQjJykKICAgIC5oQ2VsbCgnT3JpZ2luYWwgVVJMJykKICAgIC5oQ2VsbCgnUmVkaXJl
Y3QgVVJMJykKICAgIC5oQ2VsbCgnTWFuYWdlJykKICApIC4gJzwvdGhlYWQ+JzsKCiAgd2hp
bGUgKCRyZWRpcmVjdCA9IG5leHRSb3coJHJzKSkgewogICAgJGVkaXRMaW5rID0gaHJlZihn
VHh0KCdlZGl0JyksCiAgICAgICc/ZXZlbnQ9YXJjX3JlZGlyZWN0JmFtcDtzdGVwPWVkaXQm
YW1wO2lkPScuJHJlZGlyZWN0WydhcmNfcmVkaXJlY3RJRCddKTsKICAgICRyZWRpcmVjdExp
bmsgPSBocmVmKCdUZXN0JywkcmVkaXJlY3RbJ29yaWdpbmFsVXJsJ10pOwogICAgJGh0bWwg
Lj0gdHIoCiAgICAgIHRkKGZJbnB1dCgnY2hlY2tib3gnLCAnc2VsZWN0ZWRbXScsICRyZWRp
cmVjdFsnYXJjX3JlZGlyZWN0SUQnXSksICcnLCAnbXVsdGktZWRpdCcpCiAgICAgIC50ZCgk
cmVkaXJlY3RbJ2FyY19yZWRpcmVjdElEJ10sIDIwLCAnaWQnKQogICAgICAudGQoJHJlZGly
ZWN0WydvcmlnaW5hbFVybCddLCAxNzUpCiAgICAgIC50ZCgkcmVkaXJlY3RbJ3JlZGlyZWN0
VXJsJ10sIDE3NSkKICAgICAgLnRkKCIkZWRpdExpbmsgPHNwYW4+IHwgPC9zcGFuPiAkcmVk
aXJlY3RMaW5rIiwgMzUsICdtYW5hZ2UnKQogICAgKTsKICB9CgogICRodG1sIC49IGVuZFRh
YmxlKCk7CgogICRtZXRob2RzID0gYXJyYXkoCiAgICAnZGVsZXRlJyA9PiBnVHh0KCdkZWxl
dGUnKQogICk7CgogICRodG1sIC49IG11bHRpX2VkaXQoJG1ldGhvZHMsICdhcmNfcmVkaXJl
Y3QnLCAnYXJjX3JlZGlyZWN0X211bHRpZWRpdCcpOwoKICAkaHRtbCAuPSAnPC9mb3JtPic7
CgogICRodG1sIC49IG4uJzxkaXYgaWQ9IicuJGV2ZW50LidfbmF2aWdhdGlvbiIgY2xhc3M9
InR4cC1uYXZpZ2F0aW9uIj4nCiAgICAubi5uYXZfZm9ybSgnYXJjX3JlZGlyZWN0JywgJHBh
Z2UsICRudW1QYWdlcywgJycsICcnLCAnJywgJycsICR0b3RhbCwgJGxpbWl0KQogICAgLm4u
JzwvZGl2Pic7CgogIGVjaG8gJGh0bWw7Cgp9CgpmdW5jdGlvbiBhcmNfcmVkaXJlY3RfZWRp
dCgkbWVzc2FnZT0nJykgewogIHBhZ2V0b3AoJ2FyY19yZWRpcmVjdCcsJG1lc3NhZ2UpOwoK
ICAkb3JpZ2luYWxVcmwgPSBncHMoJ29yaWdpbmFsVXJsJyk7CiAgJHJlZGlyZWN0VXJsID0g
Z3BzKCdyZWRpcmVjdFVybCcpOwoKICBpZiAoJGlkPWdwcygnaWQnKSkgewogICAgJGlkID0g
ZG9TbGFzaCgkaWQpOwogICAgJHJzID0gc2FmZV9yb3coJ29yaWdpbmFsVXJsLHJlZGlyZWN0
VXJsJywgJ2FyY19yZWRpcmVjdCcsICJhcmNfcmVkaXJlY3RJRCA9ICRpZCIpOwogICAgZXh0
cmFjdCgkcnMpOwogIH0KCiAgJGh0bWwgPSAiPGgxIGNsYXNzPSd0eHAtaGVhZGluZyc+YXJj
X3JlZGlyZWN0PC9oMT4iOwogICRmb3JtID0gJzxoMj4nIC4gKCRpZCA/ICdFZGl0JyA6ICdB
ZGQnKSAuICcgUmVkaXJlY3Q8L2gyPic7CiAgJGZpZWxkcyA9IGFycmF5KAogICAgJ29yaWdp
bmFsVXJsJyA9PiAnUmVkaXJlY3QgZnJvbSBVUkwnLAogICAgJ3JlZGlyZWN0VXJsJyA9PiAn
UmVkaXJlY3QgdG8gVVJMJwogICk7CiAgZm9yZWFjaCAoJGZpZWxkcyBhcyAka2V5ID0+ICRs
YWJlbCkgewogICAgJGZvcm0gLj0gIjxwIGNsYXNzPScka2V5Jz48c3BhbiBjbGFzcz0nZWRp
dC1sYWJlbCc+PGxhYmVsIGZvcj0nJGtleSc+JGxhYmVsPC9sYWJlbD48L3NwYW4+IjsKICAg
ICRmb3JtIC49ICI8c3BhbiBjbGFzcz0nZWRpdC12YWx1ZSc+IiAuIGZJbnB1dCgndGV4dCcs
ICRrZXksICQka2V5LCAnJywgJycsICcnLCAnJywgJycsICRrZXkpIC4gIjwvc3Bhbj4iOwog
ICAgJGZvcm0gLj0gJzwvcD4nOwogIH0KICAkZm9ybSAuPSBlSW5wdXQoJ2FyY19yZWRpcmVj
dCcpOwogICRmb3JtIC49ICc8cD4nOwogIGlmICgkaWQpIHsKICAgICRmb3JtIC49IHNJbnB1
dCgnc2F2ZScpLmhJbnB1dCgnaWQnLCRpZCkuZklucHV0KCdzdWJtaXQnLCdzYXZlJyxnVHh0
KCdTYXZlJyksJ3B1Ymxpc2gnKTsKICB9IGVsc2UgewogICAgJGZvcm0gLj0gc0lucHV0KCdh
ZGQnKS5mSW5wdXQoJ3N1Ym1pdCcsJ2FkZCcsZ1R4dCgnQWRkJyksJ3B1Ymxpc2gnKTsKICB9
CiAgJGZvcm0gLj0gJzwvcD4nOwogICRodG1sIC49IGZvcm0oJzxkaXYgY2xhc3M9InBsdWdp
bi1jb2x1bW4iPjxkaXYgY2xhc3M9InR4cC1lZGl0Ij4nIC4gJGZvcm0gLiAnPC9kaXY+PC9k
aXY+JywgJycsICcnLCAnJywgJ2VkaXQtZm9ybScpOwoKICBlY2hvICRodG1sOwoKfQoKZnVu
Y3Rpb24gYXJjX3JlZGlyZWN0X2FkZCgpIHsKICAkb3JpZ2luYWxVcmwgPSBncHMoJ29yaWdp
bmFsVXJsJyk7CiAgJHJlZGlyZWN0VXJsID0gZ3BzKCdyZWRpcmVjdFVybCcpOwoKICBpZiAo
JG9yaWdpbmFsVXJsID09PSAnJyB8fCAkcmVkaXJlY3RVcmwgPT09ICcnKSB7CiAgICBhcmNf
cmVkaXJlY3RfZWRpdCgnVW5hYmxlIHRvIGFkZCBuZXcgcmVkaXJlY3QnKTsKICAgIHJldHVy
bjsKICB9CgogIC8vIFN0cmlwIGZpbmFsIHNsYXNoIGZyb20gb3JpZ2luYWwgdXJsCiAgJG9y
aWdpbmFsVXJsID0gcnRyaW0oJG9yaWdpbmFsVXJsLCAnLycpOwoKICAkcSA9IHNhZmVfaW5z
ZXJ0KCJhcmNfcmVkaXJlY3QiLAogICAgIm9yaWdpbmFsVXJsID0gJyIudHJpbShkb1NsYXNo
KCRvcmlnaW5hbFVybCkpLiInLCByZWRpcmVjdFVybCA9ICciLnRyaW0oZG9TbGFzaCgkcmVk
aXJlY3RVcmwpKS4iJyIKICApOwoKICAkR0xPQkFMU1snSUQnXSA9IG15c3FsX2luc2VydF9p
ZCgpOwoKICBpZiAoJHEpIHsKICAgICRtZXNzYWdlID0gZ1R4dCgnUmVkaXJlY3QgYWRkZWQn
KTsKICAgIGFyY19yZWRpcmVjdF9saXN0KCRtZXNzYWdlKTsKICB9Cn0KCmZ1bmN0aW9uIGFy
Y19yZWRpcmVjdF9zYXZlKCkgewoKICBpZiAoISRpZD1ncHMoJ2lkJykpIHsKICAgIGFyY19y
ZWRpcmVjdF9saXN0KCdVbmFibGUgdG8gc2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJuOwog
IH0KCiAgJG9yaWdpbmFsVXJsID0gZ3BzKCdvcmlnaW5hbFVybCcpOwogICRyZWRpcmVjdFVy
bCA9IGdwcygncmVkaXJlY3RVcmwnKTsKCiAgaWYgKCRvcmlnaW5hbFVybCA9PSAnJyB8fCAk
cmVkaXJlY3RVcmwgPT0gJycpIHsKICAgIGFyY19yZWRpcmVjdF9lZGl0KCdVbmFibGUgdG8g
c2F2ZSByZWRpcmVjdCcpOwogICAgcmV0dXJuOwogIH0KCiAgLy8gU3RyaXAgZmluYWwgc2xh
c2ggZnJvbSBvcmlnaW5hbCB1cmwKICAkb3JpZ2luYWxVcmwgPSBydHJpbSgkb3JpZ2luYWxV
cmwsICcvJyk7CgogICRpZCA9IGRvU2xhc2goJGlkKTsKCiAgJHJzID0gc2FmZV91cGRhdGUo
ImFyY19yZWRpcmVjdCIsCiAgICAib3JpZ2luYWxVcmwgICAgPSAnIi50cmltKGRvU2xhc2go
JG9yaWdpbmFsVXJsKSkuIicsICByZWRpcmVjdFVybCA9ICciLnRyaW0oZG9TbGFzaCgkcmVk
aXJlY3RVcmwpKS4iJyIsCiAgICAiYXJjX3JlZGlyZWN0SUQgPSAkaWQiCiAgKTsKCiAgaWYg
KCRycykgewogICAgJG1lc3NhZ2UgPSBnVHh0KCdSZWRpcmVjdCB1cGRhdGVkJyk7CiAgICBh
cmNfcmVkaXJlY3RfbGlzdCgkbWVzc2FnZSk7CiAgfQp9CgpmdW5jdGlvbiBhcmNfcmVkaXJl
Y3RfbXVsdGllZGl0KCkgewogICRzZWxlY3RlZCA9IHBzKCdzZWxlY3RlZCcpOwoKICBpZiAo
ISRzZWxlY3RlZCB8fCAhaXNfYXJyYXkoJHNlbGVjdGVkKSkgewogICAgYXJjX3JlZGlyZWN0
X2xpc3QoKTsKICAgIHJldHVybjsKICB9CgogICRtZXRob2QgPSBwcygnZWRpdF9tZXRob2Qn
KTsKICAkY2hhbmdlZCA9IGFycmF5KCk7CgogICRtZXNzYWdlID0gJyc7CgogIHN3aXRjaCAo
JG1ldGhvZCkgewogICAgY2FzZSAnZGVsZXRlJzoKCiAgICAgIGZvcmVhY2ggKCRzZWxlY3Rl
ZCBhcyAkaWQpIHsKICAgICAgICAkaWQgPSBkb1NsYXNoKCRpZCk7CiAgICAgICAgaWYgKHNh
ZmVfZGVsZXRlKCdhcmNfcmVkaXJlY3QnLCAnYXJjX3JlZGlyZWN0SUQgPSAnLiRpZCkpIHsK
ICAgICAgICAgICRjaGFuZ2VkW10gPSAkaWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgICRt
ZXNzYWdlID0gY291bnQoJGNoYW5nZWQpLicgcmVkaXJlY3RzIGRlbGV0ZWQnOwogICAgICBi
cmVhazsKICB9CgogIGFyY19yZWRpcmVjdF9saXN0KCRtZXNzYWdlKTsKfQoKLy8gSW5zdGFs
bGF0aW9uIGZ1bmN0aW9uIC0gYnVpbGRzIE15U1FMIHRhYmxlCmZ1bmN0aW9uIGFyY19yZWRp
cmVjdF9pbnN0YWxsKCkKewoKICAvLyBGb3IgZmlyc3QgaW5zdGFsbCwgY3JlYXRlIHRhYmxl
IGZvciB0d2VldHMKICAkc3FsID0gIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICIuUEZY
LiJhcmNfcmVkaXJlY3QgIjsKICAkc3FsLj0gIihhcmNfcmVkaXJlY3RJRCBJTlRFR0VSIEFV
VE9fSU5DUkVNRU5UIFBSSU1BUlkgS0VZLAogICAgb3JpZ2luYWxVcmwgVkFSQ0hBUigyNTUp
LAogICAgcmVkaXJlY3RVcmwgVkFSQ0hBUigyNTUpKTsiOwoKICBpZiAoIXNhZmVfcXVlcnko
JHNxbCkpIHsKICAgIHJldHVybiAnRXJyb3IgLSB1bmFibGUgdG8gY3JlYXRlIGFyY19yZWRp
cmVjdCB0YWJsZSc7CiAgfQoKfQoKLy8gVW5pbnN0YWxsIGZ1bmN0aW9uIC0gZGVsZXRlcyBN
eVNRTCB0YWJsZSBhbmQgcmVsYXRlZCBwcmVmZXJlbmNlcwoKZnVuY3Rpb24gYXJjX3JlZGly
ZWN0X3VuaW5zdGFsbCgpCnsKICAkc3FsID0gIkRST1AgVEFCTEUgSUYgRVhJU1RTICIuUEZY
LiJhcmNfcmVkaXJlY3Q7IjsKICBpZiAoIXNhZmVfcXVlcnkoJHNxbCkpIHsKICAgIHJldHVy
biAnRXJyb3IgLSB1bmFibGUgdG8gZGVsZXRlIGFyY19yZWRpcmVjdCB0YWJsZSc7CiAgfQp9
IjtzOjM6Im1kNSI7czozMjoiOTgzYTY3MmMwZjczNDM5YTllMWJhOGI0NTM4YjQ0YmYiO30=
